From 6b275d95fbdbc8374a215ecb2551f0fca3438d81 Mon Sep 17 00:00:00 2001
From: Kang Xiao <kxiao.tiger@gmail.com>
Date: Tue, 18 Feb 2014 23:23:50 +0800
Subject: [PATCH] STORM-132 sort supervisor by free slot in desending order in
 EvenScheduler to schedule more evenly between supervisor

---
 storm-core/src/clj/backtype/storm/scheduler/EvenScheduler.clj | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/storm-core/src/clj/backtype/storm/scheduler/EvenScheduler.clj b/storm-core/src/clj/backtype/storm/scheduler/EvenScheduler.clj
index 28b9202..828606d 100644
--- a/storm-core/src/clj/backtype/storm/scheduler/EvenScheduler.clj
+++ b/storm-core/src/clj/backtype/storm/scheduler/EvenScheduler.clj
@@ -22,7 +22,12 @@
     :implements [backtype.storm.scheduler.IScheduler]))
 
 (defn sort-slots [all-slots]
-  (let [split-up (vals (group-by first all-slots))]
+  (let [split-up
+         (map second
+           (reverse
+             (sort
+               (for [[host ports] (group-by first all-slots)]
+                 [(count ports) ports]))))]
     (apply interleave-all split-up)
     ))
 
-- 
1.8.5.1

