From 837b9e50acbfb3b91009ed08259c44e0efebcebf Mon Sep 17 00:00:00 2001
From: JuDasheng <judasheng@meituan.com>
Date: Thu, 7 Aug 2014 16:39:59 +0800
Subject: [PATCH] fix the problem of log level implementation to compatible
 with old log protocol with no loglevel

---
 storm-core/src/jvm/backtype/storm/multilang/JsonSerializer.java | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/storm-core/src/jvm/backtype/storm/multilang/JsonSerializer.java b/storm-core/src/jvm/backtype/storm/multilang/JsonSerializer.java
index fc97073..084a952 100644
--- a/storm-core/src/jvm/backtype/storm/multilang/JsonSerializer.java
+++ b/storm-core/src/jvm/backtype/storm/multilang/JsonSerializer.java
@@ -147,8 +147,11 @@ public ShellMsg readShellMsg() throws IOException, NoOutputException {
         shellMsg.setMetricParams(paramsObj);
 
         if (command.equals("log")) {
-            long logLevel = (Long)msg.get("level");
-            shellMsg.setLogLevel((int)logLevel);
+            Object logLevelObj = msg.get("level");
+            if (logLevelObj != null && logLevelObj instanceof Long) {
+                long logLevel = (Long)logLevelObj;
+                shellMsg.setLogLevel((int)logLevel);
+            }
         }
 
         return shellMsg;
-- 
2.0.3

